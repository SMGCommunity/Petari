#include "revolution/wpad.h"
#include <cstdio>

static u8 SEED;
static u8 NUM_A;
static u8 NUM_B;
static u8 NUM_C;

// clang-format off
static u8 base[] = {
0xa8, 0x77, 0xa6, 0xe0, 0xf7, 0x43,
0x5a, 0x35, 0x85, 0xe2, 0x72, 0x97,
0x8f, 0xb7, 0x1a, 0x62, 0x87, 0x38,
0x0d, 0x67, 0xc7, 0xbe, 0x4f, 0x3e,
0x20, 0x76, 0x37, 0x8f, 0x68, 0xb7,
0xa9, 0x26, 0x3f, 0x2b, 0x10, 0xe3,
0x30, 0x7e, 0x90, 0x0e, 0x85, 0x0a,
};

static u8 tb[] = {
112,  81,   3, 134,  64,  13,  79, 235,  62, 204, 209, 135,  53, 189, 245,  11,
 94, 208, 248, 242, 213, 226, 108,  49,  12, 173, 252,  33, 195, 120, 193,   6,
194,  76,  85, 230,  74,  52,  72,  17,  30, 218, 231,  26, 132, 160, 150, 167,
227, 127, 175,  99, 156, 250,  35,  91, 121, 200, 158, 186, 178, 201,  34,  18,
 75, 179, 161, 182,  50,  73, 162, 225, 137,  57,  16, 102, 197,   7, 143,  84,
234, 145, 202,  63, 249,  25, 240, 215,  70, 188,  40,  27,  97, 232,  47, 106,
174, 157, 246,  78,   9,  20, 119,  77, 219,  31,  46, 123, 124, 241,  67, 163,
  0, 184,  19, 140, 133, 185,  41, 117, 136, 253, 210,  86,  28,  80, 151,  65,
229,  59,  96, 181, 192, 100, 238, 152, 214,  45,  37, 164, 170, 205, 125, 168,
131, 198, 171, 190,  68, 153,  38,  60, 206, 159, 191, 211, 203, 118, 122, 126,
130,   1, 138, 154, 128,  29,  14, 176,  92, 212,  56,  98, 244,  48, 224, 142,
 83, 183,   2,  87, 172, 166,  82,  10, 109, 146, 101,  23,  36,  51,  69, 114,
116, 177, 180, 247,  93, 237,  44, 255,  71,  55,  90, 144, 187, 223,  42,  22,
 89, 149, 217, 196,  39, 103, 115, 199, 104, 254, 165, 221, 107,  95, 147, 216,
236,   5,  58, 141, 110, 251,  61, 169, 105,  54, 243, 148, 222, 239,  21, 111,
139, 155,   8,  15, 220, 129,  24,  32,   4, 228, 113, 207, 233,  43,  66,  88,
  1, 160, 169,  98, 214,  63, 133, 167, 182, 212, 250,  21, 102,  23,   9, 189,
 93,  20,  52,  38,  89, 114, 145,  84,   6,  79, 248, 176,  91, 116, 147, 153,
140, 242,  69, 205, 234,  78, 173,  16,  74, 229, 202, 238, 223, 198, 111, 159,
136, 142,   2, 204,   8, 168, 119, 148, 109,  33, 177,  40, 228,  57, 121, 150,
 96, 113, 129,  22,  46, 230, 120, 185, 196,  70, 154,  66, 174, 183, 124,  67,
179,  34,  26, 134, 194,  50,  61,  45, 156, 210,  41, 233,  99, 155, 209,  49,
 56,  94,  30,  54,  65, 187,   3,  24,  43,  62, 191, 104,  97, 252,  82, 192,
222, 224,  10,  88,  19,  90,   0, 190,  28, 144,  14,  83,  18, 253, 226, 110,
186, 206,  36,  39,  68, 127, 135, 163, 161, 213,  80,  64, 227, 249, 131, 247,
199, 162,  53, 200, 219,  25, 171,  47,  17,  37, 237,  51, 158,  85, 225,  72,
175, 115, 132, 218,  42, 170,  81, 235, 157, 149, 178, 203, 231, 112, 128, 254,
 76, 101,   4, 239, 197, 241, 195,  58, 180, 245,  95,  35, 137, 221,  48, 165,
139, 211, 246, 220,  77, 100, 215, 240, 143, 236,  86,  55,  92, 164,  13,   7,
118, 138,  44,  11, 181, 216, 193,  31, 232,  59, 244,  75,  27,  71, 108,  73,
103, 123, 146, 207, 117, 126,  32, 217, 125,  60, 151, 122, 208,   5, 107,  15,
 29, 251, 130, 152,  87, 141, 243, 106, 188, 172, 201, 166, 255, 184, 105,  12,
 76,  77, 114,   7,  90,  73,  51, 141, 162, 171,  70,  61,  99,  13, 160, 151,
255, 240, 245, 250, 192, 233, 219,  98, 228, 225, 116,  67, 220, 134,  24,  41,
 55, 244,   6, 226, 237, 111, 144,  72,  30,  45,  29, 234, 115, 148,  84, 223,
 37, 246,  71,  39, 217,  17, 119, 201, 132,  28,  91,  92,  81, 129, 166,  34,
 62,  36, 150, 200, 138, 236, 130, 124,   9, 184,  69,  74,  87, 187,  47,  80,
117, 142,  97, 112, 140, 108, 175, 208, 253, 180,  27, 174, 222, 254,  59, 181,
 54, 189,  85,   1,  14, 156,  65,  86,  95, 179,  38,   3, 131, 186,  19,  75,
202, 197,  10, 248,  96, 165, 185, 199, 195, 152,  50, 251,  18, 249, 167, 146,
170, 104, 243, 120, 126,   5,  32,  33,   2, 232, 191, 242, 176,  89, 143, 210,
203, 135, 101,  21, 241,  26, 178,  48, 173, 238,  88, 163, 139, 102,  31,  44,
215,  93,  25, 133, 168, 230, 211, 107, 161,  12, 145, 147, 106,  94,  11, 121,
227, 221,   0,  79,  60, 137, 110, 113, 105, 169, 172,  64, 229, 153,  40, 198,
 49,  78, 122, 205,   8, 158, 125, 239,  23, 252, 136, 216, 164, 109,  68, 149,
209, 183, 212, 155, 190,  42,  52, 100,  43, 207,  46, 235,  56, 206,  35, 224,
 58,  63, 247, 123, 159,  16,  83, 188,  82, 103,  22, 231, 128, 118,   4, 196,
182, 193, 194, 127, 154, 218, 213,  57,  66,  20, 157, 177,  15,  53, 214, 204,
185, 218,  56,  12, 162, 156,   9,  31,   6, 177, 182, 253,  26, 105,  35,  48,
196, 222,   1, 209, 244,  88,  41,  55,  28, 125, 213, 191, 255, 189, 200, 201,
207, 101, 190, 123, 120, 151, 152, 103,   8, 179,  38,  87, 247, 250,  64, 173,
142, 117, 166, 124, 219, 145, 139,  81, 153, 212,  23, 122, 144, 141, 206,  99,
203,  78, 160, 171,  24,  58,  91,  80, 127,  33, 116, 193, 187, 184, 183, 186,
 11,  53, 149,  49,  89, 154,  77,   4,   7,  30,  90, 118,  19, 243, 113, 131,
240, 134,   3, 168,  57,  66, 170,  40, 230, 228, 216,  93, 211, 208, 110, 111,
150, 251,  94, 188,  86, 194,  95, 133, 155, 231, 175, 210,  59, 132, 106, 167,
 83, 197,  68,  73, 165, 249,  54, 114,  61,  44, 217,  27, 161, 245,  79, 147,
157, 104,  71,  65,  22, 202,  42,  76, 163, 135, 214, 229,  25,  46, 119,  21,
109, 112, 192, 223, 178,   0,  70, 237, 198, 108,  67,  96, 146,  45, 169,  34,
 69, 143,  52,  85, 174, 164,  10, 102,  50, 224, 220,   2, 172, 232,  32, 140,
137,  98,  74, 254, 238, 195, 227,  60, 241, 121,   5, 233, 246,  39,  51, 204,
242, 158,  17, 129, 126, 128,  16, 138, 130, 159,  72,  13, 215, 180, 252,  47,
181, 199, 221, 136,  20, 107,  43,  84, 234,  29, 148,  92, 176, 239,  18,  36,
205, 235, 225, 226, 100, 115,  63,  14,  82,  97,  37,  62, 248,  15,  75, 236,
192,   0,  48, 246,   2,  73,  61,  16, 110,  32, 201, 166,  47, 254,  44,  43,
117,  46,  69,  38, 171,  72, 169, 128, 252,   4, 204, 211, 181, 186, 163,  56,
 49, 125,   1, 217, 167, 123, 150, 182,  99, 105,  78, 247, 222, 224, 120, 202,
 80, 170,  65, 145, 101, 136, 228,  33, 133, 218,  58,  39, 190,  28,  62,  66,
 94,  23,  82, 127,  31, 137,  36, 111, 143,  92, 103, 116,  14,  18, 135, 141,
233,  52, 237, 115, 196, 248,  97,  91,   5, 223,  89,  76, 151, 121, 131,  24,
164,  85, 149, 235, 189,  83, 245, 241,  87, 102,  70, 159, 178, 129,   9,  81,
134,  34,  22, 221,  35, 147, 118,  41, 194, 215,  29, 212, 191,  54,  63, 234,
 75,  17,  50, 185,  98,  84,  96, 214, 109,  67, 154,  13, 146, 156, 176, 239,
 88, 108, 157, 119,  45, 112, 250, 243, 179,  11, 226,  64, 126, 244, 138, 229,
140,  60,  86, 113, 209, 100, 225, 130,  10, 203,  19,  21, 144, 236,   3, 153,
175,  20,  93,  15,  51,  74, 148, 165, 168,  53,  27, 227, 106, 198,  40, 255,
 77, 231,  37, 132, 172,   8, 174, 197, 162,  42, 184,  55,  12, 122, 160, 195,
206, 173,   6,  26, 158, 139, 251, 213, 240, 193,  30, 208, 180, 155, 177,  68,
242,  71, 199, 104, 207, 114, 187,  79,  90, 249, 220, 107, 219, 210, 232, 124,
200, 238, 152, 161, 230, 216,  57,   7,  95, 253, 142,  25, 183,  59, 188, 205,
124, 227, 129, 115, 178,  17, 191, 111,  32, 152, 254, 117, 150, 239, 108, 218,
 80, 225,   9, 114,  84,  69, 186,  52, 128,  91, 237,  62,  83,  44, 135, 164,
 87, 243,  51,  63,  60, 183, 103, 180, 163,  37,  96,  79,   7, 107,  27,  71,
 21,  15, 228,  10, 234, 209,  50, 120,  54,  73, 141,  75, 210, 188, 165, 220,
 29,  13,  77, 205, 154, 130,  95, 252, 148, 101, 190, 226, 244, 201,  30,  68,
203, 158,  12, 100, 113,  38,  99, 179,  20, 232,  64, 112, 138,  14,  25,  66,
109, 172, 136,  16,  92, 223,  65, 169, 173, 229, 251, 116, 204, 213,   6, 142,
 89, 134, 206,  31,  61, 118, 224, 143, 185, 119,  39, 123, 166, 216,  41, 211,
236, 184,  19, 247, 250, 195,  81, 106, 222,  74,  90, 235, 194, 139,  35,  72,
146, 207,  98, 168, 153, 248, 208,  46, 133,  97,  67, 200, 189, 240,   5, 147,
202,  78, 241, 125,  48, 253, 196, 105, 102,  47,   8, 177,  82, 249,  33, 230,
122,  43, 221,  57, 132, 255, 192, 145, 214,  55, 212, 127,  45, 155,  93, 161,
 59, 110, 181, 197,  70,   4, 245, 144, 238, 126, 131,  28,   3,  86, 182, 170,
  0,  23,   1,  53,  85, 121,  11,  18, 187,  26,  49, 231,   2,  40,  22, 193,
246, 162, 219,  24, 156, 137, 104,  56, 151, 171, 199,  42, 215,  58, 242, 198,
 36,  76, 176,  88, 160,  34,  94, 157, 217, 167, 233, 174, 175, 140, 149, 159,
 40, 183,  32, 215, 176,  48, 195,   9,  25, 192, 103, 214,   0,  60, 126, 231,
233, 244,   8,  90, 248, 184,  46,   5, 166,  37, 158,  92, 216,  21,  13, 225,
246,  17,  84, 107, 205,  33,  70, 102,  94, 132, 173,   6,  56,  41,  68, 197,
162, 206, 241, 170, 193,  64, 113, 134, 181, 239, 252,  54, 168, 203,  10,  72,
 39,  69, 100, 163, 175, 140, 178, 198, 159,   7, 137, 220,  23, 211,  73, 121,
251, 254,  29, 208, 185, 136,  67,  82, 188,   1, 120,  43, 125, 148, 199,  14,
222, 165, 213, 155, 204, 247,  97, 122, 194, 116, 129,  57,   3, 171, 150, 160,
 55, 189,  45, 114, 117,  63, 201, 212, 142, 111, 249, 141, 237,  98, 219,  28,
223,   4, 172,  27, 108,  20,  75,  99, 240, 191, 180, 130, 236, 123,  26,  89,
146, 210,  16,  96, 182,  61,  95, 230, 128, 110, 112, 196, 242,  53, 217, 124,
238, 229,  65, 164,  91,  80, 221, 187,  76, 243,  31, 157,  93,  87,  85,  81,
151, 227,  88,  66,  77, 156, 115, 186, 200, 119,  49, 105,  38, 174, 234, 138,
218,  34, 179, 135,  86, 250, 147,  11,  52,  22,  51, 232, 228,  83, 190, 169,
177,  58,  62, 245, 144, 106, 207,  59,  18, 253, 143, 154, 167,  71, 145, 153,
235,  15,  36, 255,  35,  24, 133,  78, 127,  12, 224, 161, 226, 209,  44,  42,
 74,   2,  79,  30, 149, 104, 139, 152, 131, 109, 118, 202, 101,  50,  19,  47,
195, 130, 154, 164, 186, 129,  96,  55,  52,  53, 252, 128, 168,  81, 101, 103,
237,  48,  95,  16, 211,  74,  39,  47,  19, 185,  42, 210, 204, 225, 239, 174,
235, 190, 244, 189, 207,  67, 179, 197, 136, 132, 183, 221,  57,  64, 206,  72,
109, 155, 114,  97, 126, 231, 161,  78,  83,  46, 119,  59, 226, 201,  54,  34,
 27, 110, 115, 177,   3, 178,  76, 135, 169, 212,  77,  15, 216,  21, 108, 170,
 24, 246,  73,  87,  93, 251, 122,  20, 148,  99, 160,  17, 176, 158, 222,   5,
 70, 200, 238,  71, 219, 220,  36, 137, 156, 145, 151,  41, 233, 123, 193,   7,
 30, 184, 253, 254, 172, 198,  98, 152,  79, 241, 121, 224, 232, 107, 120,  86,
182, 141,   4,  80, 134, 202, 111,  32, 230, 234, 229, 118,  23,  28, 116, 127,
188,  13,  44, 133, 247, 102, 150, 228, 139, 117,  63,  75, 217,  56, 175, 124,
218,  11, 131,  45,  49,  50, 162, 245,  29,  89,  65,  69, 191,  60,  31, 248,
249, 138, 208,  22,  37, 105,  18, 153, 157,  33, 149, 171,   1, 166, 215, 181,
192, 125, 255,  88,  14,  58, 146, 209,  85, 227,   8, 159, 214,  62,  82, 142,
250, 163, 199,   2, 205, 223, 143, 100,  25, 140, 243, 167,  12,  94,  10, 106,
  9, 240, 147,  91,  66, 194,   6,  35, 236, 113, 173, 180, 203, 187, 112,  40,
213,  26,  92,  51, 104,  90,   0,  68, 144, 165, 196,  38,  61,  43, 242,  84,
150, 173, 218,  31, 237,  51, 225, 129, 105,   8,  13,  10, 219,  53, 119, 154, 
100, 209, 252, 120, 170,  27, 208, 103, 160, 221, 250, 108,  99, 113,   5, 132, 
 23, 106, 137,  79, 102, 127, 198,  80,  85, 146, 111, 189, 231, 210,  64, 114, 
141, 187, 236,   6,  66, 138, 228, 136, 157, 126, 122, 130,  39,  19,  65,  26, 
175, 200, 164, 118, 180, 194, 254, 109,  28, 217,  97,  48, 179, 124, 234, 247,  
 41,  15, 242,  59,  81, 193, 222,  95, 229,  42,  47, 153,  11,  93, 163,  43, 
 74, 171, 149, 165, 211,  88,  86, 238,  40,  49,   0, 204,  21,  70, 202, 230, 
134,  56,  60, 101, 245, 227, 159, 214,  91,   9,  73, 131, 112,  45,  83, 169, 
125, 226, 196, 172, 142,  94, 184,  37, 244, 185,  87, 243, 241, 104,  71, 178, 
162,  89,  32, 206,  52, 121,  92, 144,  14,  30, 190, 213,  34,  35, 177, 201, 
 24,  98,  22,  46, 145,  62,   7, 143, 216,  63, 147,  61, 212, 155, 223, 133,  
 33, 251,  17, 116, 151, 199, 215, 220,  76,  25,  69, 152, 233,  67,   2,  75, 
188, 195,   4, 156, 107, 240, 117,  82, 167,  38, 246, 197, 186, 207, 176, 183, 
174,  90, 161, 191,   3, 139, 128,  18, 110,  12, 235, 249, 192,  68,  36, 239, 
 16, 248, 168, 140, 232, 123, 255, 158,  44, 205,  96,  54, 135, 181, 148, 166, 
 84, 115,  58,  20,  78,   1,  29, 182, 253,  55,  72,  77,  57, 203, 224,  50, 
};

static u8 base3[] = 
{
 84,  41,  40,  78,  15, 252,
164, 108, 135,  80,  73,  60,
242, 180, 177, 249, 195,  88,
 46, 131,  95, 113, 138, 155,
130, 202, 194, 190, 186, 117,
145,  96, 120, 168,  42,  76,
 37,  91, 139, 176, 218, 175
};

static u8 tb3[] = {
164,  56,  51, 105, 212, 245, 106, 168, 215, 236, 116, 166, 123, 199,  60,  65, 
183,  33, 152,  74, 141, 200,  40, 243, 248,  50, 145, 171, 173,  52, 134,  48, 
 76, 188, 255, 206,  20,  30,  46, 249,  49,  89, 133, 135, 252, 194, 253,  62, 
187,  86, 136, 139, 191,  71,  97, 146, 177, 148, 122,  81, 156, 143, 176,  73, 
155, 185,   5,  54,  16,  59, 213, 211,  12, 150, 203, 121,  96,  78, 162, 181, 
209, 238,  23, 186,  31,   9, 120, 147, 180,  53,  58, 157,  29,  57, 201,  63, 
124,  47, 202,  11,  55, 230,  27, 208, 103, 217,  24, 132, 225,  66,  90, 126, 
184, 151, 223,  84, 112,   3, 110, 219,  99, 174,  85,  93, 196,  75, 137, 204, 
 19, 179, 144, 246, 233, 178, 163, 190,  45,  25, 115,  35,  32, 127,  64,   2, 
158, 195, 107,  26,  82, 218,  41, 128,  13,  95, 214, 142,  14,  34, 227, 109, 
220,  88, 117, 224,   1,  10,  38,  80,   8, 169, 254,  77,  21, 247, 108, 207, 
 79, 240, 100,  94, 198, 104, 138, 172, 222, 182,  72, 102, 237, 111, 113,  69, 
 61, 235, 159,   4,  37,  92, 189, 101, 221,  83, 205,  36, 239, 114, 232, 154, 
231,  22, 193,   0, 119,  44, 125, 165,  42,  68,  98,  39, 244, 192,   7,  28, 
 91, 153, 130,  87,   6, 250, 251,  18, 175, 167, 210, 170,  43, 140, 242, 216, 
131, 160, 118,  17, 197,  67, 129,  70, 229, 241, 234, 149, 226, 228,  15, 161, 
 43, 210, 165, 142,  38,   9,  15, 247,  69,  91,  60, 253, 140, 114,  34, 191, 
202, 218, 231, 175,  22, 178,  94, 138, 111, 148, 183, 214,  28, 177,  41,  76, 
181,  67,  24, 156,  49, 206, 182, 132, 113,  96, 127,  42, 110,  53, 248, 166, 
 84, 234, 116, 136, 172,   3,  25,  27,  61, 121, 252, 238,  66, 159, 147, 219, 
128, 173, 139,  21,  65,  93,  72, 205, 124, 163,  44,  50,  31,  99, 209, 237, 
 79,   4, 102,  30,  70, 155, 187,  56,   6, 126, 149, 200,  95,  74,  81, 107, 
151, 190,  46, 152, 189, 236,  14,   5,  10, 160,   1,  82, 133, 192, 216,  59, 
254,  18, 100, 225, 243,  36,  75, 245,  73, 122, 228,  78,  52,  37,   8,  83, 
 26, 227, 239, 134, 223, 241, 145, 235, 198, 217, 211, 131,  20,  29, 176, 167, 
 11,  16,  64, 137, 180, 212,  58,   2,  12, 221,  47,  90,  86,  40, 174,  45, 
 85, 246, 193, 213, 168,  68, 207,  88, 157, 179,  35, 197, 164,  62, 125,  48, 
 19, 106,  97, 208, 240,  63, 103, 203,  13, 255, 146, 104, 224, 129, 105,  98, 
171, 117,  89,  17, 242, 201,   7, 233, 199, 161, 194, 120,  51,  23, 108, 249, 
196, 184, 185, 220,  39, 144, 188, 251, 112, 170, 232, 150, 115,  57, 244, 195, 
119, 135, 222,   0, 162, 154, 226, 123, 250,  54, 101, 109,  32, 215,  87,  92, 
 55, 143,  77, 158,  71, 169, 229, 204, 153, 141, 118,  80, 186, 230, 130,  33, 
176,  13, 235, 117, 109,  34, 206, 231,  99,  44, 222, 226, 245,  69, 186,  68, 
149,  31, 229,  57, 215, 165, 181, 141,   7, 147, 253, 188,  98, 126, 137, 179, 
 72,  89, 127, 211, 190, 208, 242,  54,  83, 159, 230, 177, 130, 192, 148, 184, 
 47,   3,  36,  60,   0,  10,  66, 101, 232,  92, 150, 213, 169, 144, 185, 133, 
233, 234,  14,  22, 123, 132,  41,  78,  94, 135, 157,  53,   6, 134, 225, 224, 
227, 236, 239, 200,  82,  95, 100, 228,  70,  48,  90, 205, 237, 209,  81, 129, 
 12,  58, 102, 254,   4, 103,  30, 214, 247, 140, 189,  51, 178, 145, 212, 168, 
 74,  20,  11, 121,  88, 136, 182, 193,  25,  86, 248,  39, 172,  35, 153, 180, 
195,  18, 243,  32, 120,  52,  73, 220, 216,   5, 187,  85, 138, 113,  17,  33, 
199, 219, 241, 155, 246, 158,  23, 249, 250, 251, 167,  96, 142, 110, 139, 202, 
 21, 171, 221,  61, 166, 198, 128, 194, 218,  76,  29,  79,  93, 146, 105, 152, 
162,  50, 156,  43, 106,  65,  26, 108, 163, 197, 114, 170, 204, 107,  16,  91, 
 77,  87,  40, 104, 238,   9,  64, 240, 173,  38,  46,  45, 154, 160, 122, 203, 
116,  62,  27, 112, 252,  67, 196, 119,   8, 183, 207,  28, 125,  24,  15,  19, 
 37, 191,  97,   1,  55, 174, 210,  42, 124, 151, 175,  63,  80, 223, 111, 161, 
164, 255,  56, 201, 131, 143,  84, 115,   2,  71, 217,  49, 118,  59,  75, 244, 
156,  73, 199, 182,  20,  33,  95,  82, 243, 183, 213, 242, 149, 160,  37,  84, 
217, 231, 176, 191, 105,  19, 120, 240,  51, 224, 140, 148, 219, 230, 167, 181, 
236, 194,  99, 227,  24, 185,  75, 116, 229,   1, 142, 177,  39,  53, 180,  61, 
 38,  72,  31, 250, 187, 144, 211, 152, 223, 164,  55, 103,  93, 128, 210,  98, 
225, 111, 150,  45, 168, 106, 151,  48, 137, 234,  58, 190,  34,  25,  65, 172, 
121, 241, 133, 238, 112, 192,  10,  27, 127, 193, 208, 166, 244,  22, 252, 186, 
 78,  74, 201,  18, 138,  26, 157, 197,  56, 212, 222, 173, 196,  67,   3, 179, 
247, 169,  89, 109, 163,  32,  54,  77, 134,  91, 174,  97,  23, 165, 147, 220, 
 80,  44, 239,  42, 104, 117, 122, 139, 214, 251,   0, 158,  46,   2, 205, 237, 
 71, 171, 130, 189, 113,  17, 178, 102,  94,  60, 124,   8, 110, 246,   9,  69, 
 63,  90,  15, 132, 204, 221, 115,  13, 248, 146, 232,  11, 233, 207,  79,  28, 
218,  16,  14, 159, 162,  88, 255,  64, 135, 119,  47,  96,  76, 195,  40, 136, 
 21, 129,   6,  86, 209,  85, 141, 155,  87, 131, 101, 145,  52, 206,  83,  66, 
  4,  12,  70, 125,   7,  41, 254,  36,  43, 108,   5,  50, 203, 114,  30, 126, 
170, 228, 153, 107, 226, 161, 216,  29,  62, 198, 200,  92, 143, 215, 100,  57, 
184,  68,  35,  49, 123,  81, 202,  59, 245, 249, 253, 118, 235, 154, 175, 188, 
148, 197,  38,  63, 246, 248, 147, 110, 115, 132, 130, 231,  84,  44,  87, 170, 
 70, 109, 122, 126, 247, 230, 154, 159, 214, 237, 225, 240, 245, 103, 222, 244, 
209,  65, 252,  74,  83, 200,  77,  48,  78,  54,  64,  49, 141, 152,  12, 162, 
192, 234, 108,  10,  24,  88, 143, 238,   0,  98, 131, 226,  13,  91, 139, 199, 
215,   4, 144, 161, 233, 205,  22,  21,  86, 120, 146, 119, 213,  18, 227, 206, 
 25, 190,  52,  80,  81,  75,  50, 193,   6,   7,  55,  53,  96, 172, 173,  43, 
 39, 235,   8, 155, 219, 123,  79,   3, 121,  17,  23, 211, 241, 217, 166, 102, 
243, 207, 114, 153,  58, 202,  61,  11, 137,  71,  36, 223, 101,  20,  56,  97, 
194, 111,  19, 175, 145,  62,  42,  51, 218, 224, 165,  59,  27,  29, 160,  34, 
106, 196, 149, 250, 182, 178, 105, 156, 242, 128,  68,  33, 239, 157, 167, 203, 
169, 150,  30,  67, 118, 138, 127,  60, 208, 168,  89,  32, 220, 129, 201, 204, 
151, 164, 188, 189, 125, 171, 163, 180,  82, 228, 176, 140, 185,  47, 158, 183, 
 76, 232,  69,  99,   9, 100,  93, 136, 210,  28, 116, 135,  72,  94,  85, 107, 
179, 236,  57,   5,  45,  40,  16, 177, 198, 254, 112,  41,  90, 251,  73,  35, 
221, 134,   1, 229, 212,  37,  66, 174, 133, 117, 255, 104,  46,  92,  31,   2, 
186, 181, 191, 124, 253, 113, 249, 142,  95, 184,  14,  15, 195,  26, 187, 216, 
170, 243, 199, 169,  67,  32, 198, 208, 244,   7,   0, 159, 137, 142, 186, 224, 
 90,  36,  31,  42, 221, 212, 227,  13, 176, 237, 190, 178,  43, 117,  46, 102, 
 23, 110, 124,  82, 118, 145,   1,  89,  97,  60, 134,  44, 253,  45, 246,  11, 
171, 229,  34,  65, 103, 114, 194, 173, 189, 254, 150, 250, 123, 158,  64,  95, 
113, 152,  76, 136, 251, 235, 107, 201, 206, 187, 192,   3,  91,  58, 174,  21, 
 62,  86,  77, 216,  59,  80,  53, 132, 151,  52, 196,  84, 204,  78,  94, 205, 
230, 104,  79, 179, 180, 157,  93, 165, 163, 120, 233,  56, 126,   8,  96, 108, 
219, 127, 191, 130,  48, 226,  72,  25, 109,  26, 162, 223,  88, 149, 105,  81, 
 49, 218,  12,  75, 164,  10,  69,  39, 215,  30, 101, 135,  27, 183, 181,  66, 
140,  38, 111,  37, 234, 252, 239, 138, 167,  16, 188, 245, 160,  33,  68,  87, 
  2, 210,  47,  99,  61, 213, 121, 156,   5, 242, 228, 207,  41, 241,  83,  14, 
122, 177,  20,  18, 249, 247,  17, 139,  54, 166, 182, 214, 161,  24,  57, 236, 
  4, 193, 232, 141,  40, 153, 115, 144, 112, 211,  29, 143, 203, 248, 240, 185, 
222, 119, 146,  50, 231, 238, 133,  51,  19, 168, 154,  63, 200, 225, 128, 155, 
  6,  35,  55,   9, 209, 255, 172, 129, 148, 100, 175,  74,  70, 125,  22, 195, 
 85,  71, 202, 217,  15,  28, 106, 116, 220,  73, 131, 197, 184,  92, 147,  98, 
220,  47, 212, 240, 134,  24, 177, 140,  79, 185, 213, 151,  27,  67,  76,  29, 
234,  91, 195,  17, 130, 252, 162,  74, 160, 127,  71, 175, 163,  10,  89, 173, 
229,   6,  42,  78, 110, 227,  64, 219,  83, 131,  73, 180, 186, 113, 149, 155, 
 81, 179, 172, 209, 174, 196, 207,  75,  77, 105,  22, 236,  11, 165, 145, 115, 
  7,  59,  25, 132, 194, 109, 141, 178, 189,  37,  72, 150, 197,  32,  26, 161, 
139, 198, 225,  63,  40, 167, 231,  18, 118, 176,  28, 142, 208,  69, 144, 202, 
152, 214, 166,  54,  50, 114, 138, 168,  13,  58, 159,  55,  60, 137, 221, 103, 
 34, 129, 233,  21,  65,  66, 245,  46, 102, 210,  97, 128,  15,  84, 147, 170, 
237,  93, 228, 125,  48, 201,  61, 224, 226,  38, 242,   8, 169,  99,  36,  45, 
143, 121, 156, 218, 191,  85,  98,  92,   0, 182,  39, 106,  14, 146,   1, 215, 
255, 235,  31, 116,  20, 153, 247,  68, 135,  51, 108, 148,  19,  80, 117, 104, 
 16,  23, 187,  44, 107,   4, 223, 188,  53, 111, 183, 241,  87, 193, 230, 124, 
184, 119, 101,  62,  95, 211, 100, 203,   2,  30,  56, 171, 136,  96,  94, 157, 
190, 200, 164, 216,  82, 123,  41, 244,   5, 112, 206, 120, 133,  57,  35, 243, 
 52,  88, 158, 251,  49, 204,  70, 239, 154,  90, 254, 122,  86, 253, 238, 222, 
 12, 249, 205, 192,  43, 217, 181,   9, 246, 199,  33, 250, 248,   3, 232, 126, 
159, 189, 121, 145, 204, 120, 127, 213,  27, 238, 187, 183, 220, 237, 109, 155, 
239,  88, 251,  93, 103, 105,  31,  78, 175,  98,  75, 184, 168, 174,   8,  96, 
140, 173,  36, 161,  72,  47, 138,   0, 144, 177,  83,   7,  38,  18, 114, 157, 
 86,  28,  81,  52,  70,  46, 129, 207, 179, 243,  55, 241, 250,  60, 186,   6, 
 84, 133,  20,  89,  54,  94, 165,  85,  12,  82, 137, 203, 151, 226,  59,  17, 
190, 217,  29, 252,  19, 125, 160,   5,  65, 195, 197, 253, 118,  51, 130, 205, 
136,  22,  26,  41, 135,  30,  64, 111, 232,   3,  58,  80, 166, 228, 244,  79, 
214, 152,  57, 113, 208, 242, 240,  62, 234, 141,  44, 162, 169,  87,  11, 139, 
 13, 170, 233,  49, 194,  53,  92, 209,  56, 255,   1, 167, 236, 128, 249,  35, 
223,  48, 235,  42, 176,  23, 210,  25, 110, 218,  37, 158, 182,  76, 198, 147, 
219, 117, 107,  63,  21, 115, 254,  61, 101, 102, 181, 122, 154,  50, 202, 104, 
142,  34, 192,  68,  67, 163,  14,  33, 185,   2,  77, 200, 180,  10, 246, 211, 
 69, 150,  90, 132, 112,  24, 212, 191, 196, 164, 156, 193, 224,  71, 199, 229, 
230, 126,  99, 221, 106, 206,  40, 148, 231,  16, 188,  95,   4, 100,  45, 143, 
108, 247,  43, 146, 131, 216, 153, 227, 222, 215,  91, 171,  74, 116, 119, 201, 
245, 123,  15,  32, 248,  97,  66, 134, 124,  73, 149, 172,  39, 225,   9, 178, 
 11, 211, 111,  10,  57, 119,  33,  23, 143, 199, 213, 229, 181, 185,  17, 164, 
220, 163, 205, 187,  26, 129, 138, 183, 217,  91,  71,  97, 142, 136, 184,  12, 
 59,  58, 154,  84, 253,  45,  83, 180, 195,  95, 105,  96, 177, 171,  38,  86, 
131, 126, 179,  61,  74,  13,  90,  29,  30,  89, 214,  53, 140, 243, 155,  24, 
102, 191, 226,  98, 146, 123, 255,  46,  92, 207,  37, 196, 175, 210,  41,  99, 
165, 178, 249, 106, 193, 251,  20, 135,  85, 115,  44,  68,  49, 121, 244,  42, 
 65,   1,  36, 128,  25, 101,  77, 157, 156, 232,  19, 162, 192, 197, 254, 107, 
206,  80, 248,   4,  72, 168,   6,  22, 190, 103, 186, 234, 198,  15, 215, 116, 
133, 182, 216,  14,  76, 147,  21, 189, 230, 120,   3,   5,  50, 247,  52, 228, 
173,  48, 152, 161,  39, 158, 246,  67, 100,  60,  73, 188, 240, 153, 221,  18, 
209, 201,  93, 124,  34, 117,  31,  40,  47,   9, 194, 132, 109, 250,  35,  63, 
125, 145, 137, 130, 134,  88, 223, 118, 233, 170, 219, 172,  43, 245, 144,  66, 
 32, 225, 160, 237, 212,  82,  16, 239,  62, 227,  28, 218, 150, 176, 114,  56, 
159, 122,  27, 222,   2, 166,  78, 151,  51,  54, 110, 224, 200,  79, 252,  55, 
113, 236, 148,   0, 149, 208, 167, 203, 241, 112, 169, 139,  64, 242,  75,  70, 
 69, 238,  81, 141, 204, 108, 202, 235, 127, 104,   7, 174,  94,  87,   8, 231 
};

// clang-format on
static u8 random() {
    SEED = (u8)(((u32)SEED * NUM_A + NUM_B) % NUM_C);
    return SEED;
}

static u8 ror(u8 src, u8 rot) {
    u8 ret;
    u8 rt;

    rt = (u8)(rot % 8);
    ret = (u8)(src >> rt | src << (8 - rt));

    return ret;
}

static u8 rol(u8 src, u8 rol) {
    u8 ret;
    u8 rl;

    rl = (u8)(rol % 8);
    ret = (u8)(src << rl | src >> (8 - rl));

    return ret;
}

void DEBUGPrint(const char*, ...);

void WPADiCreateKey(s32 chan) {
    BOOL enable;
    WPADControlBlock* p_wpd = _wpdcb[chan];

    u8 idx;
    u8 baseIdx;
    u8 tblRnd[10];
    u8 ft[8];
    u8 sb[8];
    u8 key[6];
    u8 i;

    SEED = (u8)((OSGetTick() >> 8) & 0xff);
    NUM_A = (u8)((OSGetTick() >> 16) & 0x3f);
    NUM_B = (u8)((OSGetTick() >> 24) & 0x4c);
    NUM_C = 0xff;

    idx = (u8)(random() % 7);
    baseIdx = (u8)(idx * 6);

    for (i = 0; i < 10; i++) {
        tblRnd[i] = tb[random()];
    }

    DEBUGPrint("ans : %d %d %d %d %d %d\n", base[baseIdx], base[baseIdx + 1], base[baseIdx + 2], base[baseIdx + 3], base[baseIdx + 4],
               base[baseIdx + 5]);

    DEBUGPrint("rand: %d %d %d %d %d %d %d %d %d %d\n", tblRnd[0], tblRnd[1], tblRnd[2], tblRnd[3], tblRnd[4], tblRnd[5], tblRnd[6], tblRnd[7],
               tblRnd[8], tblRnd[9]);

    DEBUGPrint("t0  : %d %d %d %d %d %d %d %d %d %d\n", tb[tblRnd[0]], tb[tblRnd[1]], tb[tblRnd[2]], tb[tblRnd[3]], tb[tblRnd[4]], tb[tblRnd[5]],
               tb[tblRnd[6]], tb[tblRnd[7]], tb[tblRnd[8]], tb[tblRnd[9]]);

    enable = OSDisableInterrupts();
    key[0] = (u8)((ror((u8)(base[baseIdx] ^ tb[tblRnd[5]]), tb[tblRnd[2]]) - tb[tblRnd[9]]) ^ tb[tblRnd[4]]);
    key[1] = (u8)((ror((u8)(base[baseIdx + 1] ^ tb[tblRnd[1]]), tb[tblRnd[0]]) - tb[tblRnd[5]]) ^ tb[tblRnd[7]]);
    key[2] = (u8)((ror((u8)(base[baseIdx + 2] ^ tb[tblRnd[6]]), tb[tblRnd[8]]) - tb[tblRnd[2]]) ^ tb[tblRnd[0]]);
    key[3] = (u8)((ror((u8)(base[baseIdx + 3] ^ tb[tblRnd[4]]), tb[tblRnd[7]]) - tb[tblRnd[3]]) ^ tb[tblRnd[2]]);
    key[4] = (u8)((ror((u8)(base[baseIdx + 4] ^ tb[tblRnd[1]]), tb[tblRnd[6]]) - tb[tblRnd[3]]) ^ tb[tblRnd[4]]);
    key[5] = (u8)((ror((u8)(base[baseIdx + 5] ^ tb[tblRnd[7]]), tb[tblRnd[8]]) - tb[tblRnd[5]]) ^ tb[tblRnd[9]]);

    DEBUGPrint("key : %d %d %d %d %d %d \n", key[0], key[1], key[2], key[3], key[4], key[5]);

    ft[0] = (u8)(tb[(idx + 1) * 256 + key[4]] ^ tb[(idx + 2) * 256 + tblRnd[3]]);
    ft[1] = (u8)(tb[(idx + 1) * 256 + key[2]] ^ tb[(idx + 2) * 256 + tblRnd[5]]);
    ft[2] = (u8)(tb[(idx + 1) * 256 + key[5]] ^ tb[(idx + 2) * 256 + tblRnd[7]]);
    ft[3] = (u8)(tb[(idx + 1) * 256 + key[0]] ^ tb[(idx + 2) * 256 + tblRnd[2]]);
    ft[4] = (u8)(tb[(idx + 1) * 256 + key[1]] ^ tb[(idx + 2) * 256 + tblRnd[4]]);
    ft[5] = (u8)(tb[(idx + 1) * 256 + key[3]] ^ tb[(idx + 2) * 256 + tblRnd[9]]);
    ft[6] = (u8)(tb[(idx + 1) * 256 + tblRnd[0]] ^ tb[(idx + 2) * 256 + tblRnd[6]]);
    ft[7] = (u8)(tb[(idx + 1) * 256 + tblRnd[1]] ^ tb[(idx + 2) * 256 + tblRnd[8]]);
    sb[0] = (u8)(tb[(idx + 1) * 256 + key[0]] ^ tb[(idx + 2) * 256 + tblRnd[1]]);
    sb[1] = (u8)(tb[(idx + 1) * 256 + key[5]] ^ tb[(idx + 2) * 256 + tblRnd[4]]);
    sb[2] = (u8)(tb[(idx + 1) * 256 + key[3]] ^ tb[(idx + 2) * 256 + tblRnd[0]]);
    sb[3] = (u8)(tb[(idx + 1) * 256 + key[2]] ^ tb[(idx + 2) * 256 + tblRnd[9]]);
    sb[4] = (u8)(tb[(idx + 1) * 256 + key[4]] ^ tb[(idx + 2) * 256 + tblRnd[7]]);
    sb[5] = (u8)(tb[(idx + 1) * 256 + key[1]] ^ tb[(idx + 2) * 256 + tblRnd[8]]);
    sb[6] = (u8)(tb[(idx + 1) * 256 + tblRnd[3]] ^ tb[(idx + 2) * 256 + tblRnd[5]]);
    sb[7] = (u8)(tb[(idx + 1) * 256 + tblRnd[2]] ^ tb[(idx + 2) * 256 + tblRnd[6]]);

    DEBUGPrint("ft  : %d %d %d %d %d %d %d %d\n", ft[0], ft[1], ft[2], ft[3], ft[4], ft[5], ft[6], ft[7]);
    DEBUGPrint("sb  : %d %d %d %d %d %d %d %d\n", sb[0], sb[1], sb[2], sb[3], sb[4], sb[5], sb[6], sb[7]);

    for (i = 0; i < 10; i++) {
        p_wpd->key[i] = tblRnd[9 - i];
    }

    for (i = 0; i < 6; i++) {
        p_wpd->key[i + 10] = key[5 - i];
    }

    memcpy(p_wpd->ft, ft, 8);
    memcpy(p_wpd->sb, sb, 8);
    OSRestoreInterrupts(enable);
}

void WPADiCreateKeyFor3rd(s32 chan) {
    BOOL enable;
    WPADControlBlock* p_wpd = _wpdcb[chan];

    u8 idx;
    u8 baseIdx;
    u8 tblRnd[10];
    u8 ft[8];
    u8 sb[8];
    u8 key[6];
    u8 i;

    SEED = (u8)((OSGetTick() >> 8) & 0xff);
    NUM_A = (u8)((OSGetTick() >> 16) & 0x3f);
    NUM_B = (u8)((OSGetTick() >> 24) & 0x4c);
    NUM_C = 0xff;

    idx = (u8)(random() % 7);
    baseIdx = (u8)(idx * 6);

    for (i = 0; i < 10; i++) {
        tblRnd[i] = tb3[random()];
    }

    DEBUGPrint("ans : %d %d %d %d %d %d\n", base3[baseIdx], base3[baseIdx + 1], base3[baseIdx + 2], base3[baseIdx + 3], base3[baseIdx + 4],
               base3[baseIdx + 5]);

    DEBUGPrint("rand: %d %d %d %d %d %d %d %d %d %d\n", tblRnd[0], tblRnd[1], tblRnd[2], tblRnd[3], tblRnd[4], tblRnd[5], tblRnd[6], tblRnd[7],
               tblRnd[8], tblRnd[9]);

    DEBUGPrint("t0  : %d %d %d %d %d %d %d %d %d %d\n", tb3[tblRnd[0]], tb3[tblRnd[1]], tb3[tblRnd[2]], tb3[tblRnd[3]], tb3[tblRnd[4]],
               tb3[tblRnd[5]], tb3[tblRnd[6]], tb3[tblRnd[7]], tb3[tblRnd[8]], tb3[tblRnd[9]]);

    enable = OSDisableInterrupts();
    key[0] = (u8)((rol((u8)(base3[baseIdx] ^ tb3[tblRnd[0]]), tb3[tblRnd[1]]) + tb3[tblRnd[6]]) ^ tb3[tblRnd[7]]);
    key[1] = (u8)((rol((u8)(base3[baseIdx + 1] ^ tb3[tblRnd[4]]), tb3[tblRnd[2]]) + tb3[tblRnd[3]]) ^ tb3[tblRnd[1]]);
    key[2] = (u8)((rol((u8)(base3[baseIdx + 2] ^ tb3[tblRnd[2]]), tb3[tblRnd[8]]) + tb3[tblRnd[4]]) ^ tb3[tblRnd[5]]);
    key[3] = (u8)((rol((u8)(base3[baseIdx + 3] ^ tb3[tblRnd[6]]), tb3[tblRnd[9]]) + tb3[tblRnd[7]]) ^ tb3[tblRnd[0]]);
    key[4] = (u8)((rol((u8)(base3[baseIdx + 4] ^ tb3[tblRnd[5]]), tb3[tblRnd[4]]) + tb3[tblRnd[8]]) ^ tb3[tblRnd[1]]);
    key[5] = (u8)((rol((u8)(base3[baseIdx + 5] ^ tb3[tblRnd[9]]), tb3[tblRnd[3]]) + tb3[tblRnd[8]]) ^ tb3[tblRnd[5]]);

    DEBUGPrint("key : %d %d %d %d %d %d \n", key[0], key[1], key[2], key[3], key[4], key[5]);

    ft[0] = (u8)(tb3[(idx + 1) * 256 + key[4]] ^ tb3[(idx + 2) * 256 + tblRnd[3]]);
    ft[1] = (u8)(tb3[(idx + 1) * 256 + key[2]] ^ tb3[(idx + 2) * 256 + tblRnd[5]]);
    ft[2] = (u8)(tb3[(idx + 1) * 256 + key[5]] ^ tb3[(idx + 2) * 256 + tblRnd[7]]);
    ft[3] = (u8)(tb3[(idx + 1) * 256 + key[0]] ^ tb3[(idx + 2) * 256 + tblRnd[2]]);
    ft[4] = (u8)(tb3[(idx + 1) * 256 + key[1]] ^ tb3[(idx + 2) * 256 + tblRnd[4]]);
    ft[5] = (u8)(tb3[(idx + 1) * 256 + key[3]] ^ tb3[(idx + 2) * 256 + tblRnd[9]]);
    ft[6] = (u8)(tb3[(idx + 1) * 256 + tblRnd[0]] ^ tb3[(idx + 2) * 256 + tblRnd[6]]);
    ft[7] = (u8)(tb3[(idx + 1) * 256 + tblRnd[1]] ^ tb3[(idx + 2) * 256 + tblRnd[8]]);
    sb[0] = (u8)(tb3[(idx + 1) * 256 + key[0]] ^ tb3[(idx + 2) * 256 + tblRnd[1]]);
    sb[1] = (u8)(tb3[(idx + 1) * 256 + key[5]] ^ tb3[(idx + 2) * 256 + tblRnd[4]]);
    sb[2] = (u8)(tb3[(idx + 1) * 256 + key[3]] ^ tb3[(idx + 2) * 256 + tblRnd[0]]);
    sb[3] = (u8)(tb3[(idx + 1) * 256 + key[2]] ^ tb3[(idx + 2) * 256 + tblRnd[9]]);
    sb[4] = (u8)(tb3[(idx + 1) * 256 + key[4]] ^ tb3[(idx + 2) * 256 + tblRnd[7]]);
    sb[5] = (u8)(tb3[(idx + 1) * 256 + key[1]] ^ tb3[(idx + 2) * 256 + tblRnd[8]]);
    sb[6] = (u8)(tb3[(idx + 1) * 256 + tblRnd[3]] ^ tb3[(idx + 2) * 256 + tblRnd[5]]);
    sb[7] = (u8)(tb3[(idx + 1) * 256 + tblRnd[2]] ^ tb3[(idx + 2) * 256 + tblRnd[6]]);

    DEBUGPrint("ft  : %d %d %d %d %d %d %d %d\n", ft[0], ft[1], ft[2], ft[3], ft[4], ft[5], ft[6], ft[7]);
    DEBUGPrint("sb  : %d %d %d %d %d %d %d %d\n", sb[0], sb[1], sb[2], sb[3], sb[4], sb[5], sb[6], sb[7]);

    for (i = 0; i < 10; i++) {
        p_wpd->key[i] = tblRnd[9 - i];
    }
    for (i = 0; i < 6; i++) {
        p_wpd->key[i + 10] = key[5 - i];
    }
    memcpy(p_wpd->ft, ft, 8);
    memcpy(p_wpd->sb, sb, 8);
    OSRestoreInterrupts(enable);
}

void WPADiDecode(s32 chan, void* p_buf, u16 len, u16 offset) {
    WPADControlBlock* p_wpd = _wpdcb[chan];
    u8 idx;
    u8* ptr;
    u16 i;

    ptr = (u8*)p_buf;

    for (i = 0; i < len; i++) {
        idx = (u8)((offset + i) % 8);
        ptr[i] = (u8)((ptr[i] ^ p_wpd->sb[idx]) + p_wpd->ft[idx]);
    }
}
